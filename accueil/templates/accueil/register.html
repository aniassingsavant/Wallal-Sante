{% extends 'base.html' %}
{% load static %}

{% block title %}S'inscrire - Wallal Sant√©{% endblock %}

{% block content %}
<section class="container py-5" data-aos="fade-up">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-success text-white py-4">
                    <h1 class="h2 mb-0 text-center">
                        <i class="fas fa-user-plus me-2"></i>Cr√©er votre compte sant√©
                    </h1>
                    <p class="text-center mb-0 mt-2">Questionnaire adaptatif pour personnaliser votre exp√©rience</p>
                </div>
                <div class="card-body p-5">
                    <form method="post" id="registrationForm">
                        {% csrf_token %}
                        
                        <!-- √âtape 1: Compte -->
                        <div class="registration-section" id="section-account">
                            <h3 class="text-success mb-4">üîê Compte utilisateur</h3>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Nom d'utilisateur *</label>
                                    <input type="text" name="username" class="form-control" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Email *</label>
                                    <input type="email" name="email" class="form-control" required>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Mot de passe *</label>
                                    <input type="password" name="password1" class="form-control" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Confirmation *</label>
                                    <input type="password" name="password2" class="form-control" required>
                                </div>
                            </div>
                            
                            <button type="button" class="btn btn-success next-section" data-next="section-personal">
                                Suivant <i class="fas fa-arrow-right ms-2"></i>
                            </button>
                        </div>

                        <!-- √âtape 2: Profil personnel -->
                        <div class="registration-section d-none" id="section-personal">
                            <h3 class="text-success mb-4">üë§ Informations personnelles</h3>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">1. Langue pr√©f√©r√©e *</label>
                                    <select name="language" class="form-control" required>
                                        <option value="fr">Fran√ßais</option>
                                        <option value="ful">Fulfulde</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">2. Pr√©nom (optionnel)</label>
                                    <input type="text" name="first_name" class="form-control">
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">3. √Çge *</label>
                                    <select name="age_group" class="form-control" required>
                                        <option value="">S√©lectionnez...</option>
                                        <option value="0-4">0‚Äì4 ans</option>
                                        <option value="5-14">5‚Äì14 ans</option>
                                        <option value="15-24">15‚Äì24 ans</option>
                                        <option value="25-44">25‚Äì44 ans</option>
                                        <option value="45-64">45‚Äì64 ans</option>
                                        <option value="65+">65 ans et plus</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">4. Sexe *</label>
                                    <select name="gender" class="form-control" required>
                                        <option value="">S√©lectionnez...</option>
                                        <option value="M">Homme</option>
                                        <option value="F">Femme</option>
                                        <option value="O">Autre</option>
                                        <option value="N">Pr√©f√®re pas dire</option>
                                    </select>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-bold">5. √ätes-vous enceinte ? *</label>
                                <select name="is_pregnant" class="form-control" required>
                                    <option value="na">Ne s'applique pas</option>
                                    <option value="yes">Oui</option>
                                    <option value="no">Non</option>
                                </select>
                            </div>

                            <div class="d-flex justify-content-between">
                                <button type="button" class="btn btn-outline-secondary prev-section" data-prev="section-account">
                                    <i class="fas fa-arrow-left me-2"></i>Pr√©c√©dent
                                </button>
                                <button type="button" class="btn btn-success next-section" data-next="section-health">
                                    Suivant <i class="fas fa-arrow-right ms-2"></i>
                                </button>
                            </div>
                        </div>

                        <!-- √âtape 3: Sant√© et maladies -->
                        <div class="registration-section d-none" id="section-health">
                            <h3 class="text-success mb-4">üè• Sant√© et maladies</h3>
                            
                            <div class="mb-4">
                                <label class="form-label fw-bold">6. Avez-vous des maladies chroniques ou r√©currentes ?</label>
                                <div class="health-checkboxes">
                                    {% for value, label in disease_choices %}
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="chronic_diseases" value="{{ value }}" id="disease_{{ value }}">
                                        <label class="form-check-label" for="disease_{{ value }}">
                                            {{ label }}
                                        </label>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-bold">Si "Autre", pr√©cisez :</label>
                                <input type="text" name="other_disease" class="form-control" placeholder="Autre maladie...">
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">7. Avez-vous des allergies ?</label>
                                    <select name="has_allergies" class="form-control allergy-toggle">
                                        <option value="false">Non</option>
                                        <option value="true">Oui</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Si oui, pr√©cisez :</label>
                                    <input type="text" name="allergies_details" class="form-control" placeholder="Allergies aux m√©dicaments, aliments...">
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Prenez-vous des m√©dicaments r√©guli√®rement ?</label>
                                    <select name="regular_medication" class="form-control medication-toggle">
                                        <option value="false">Non</option>
                                        <option value="true">Oui</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Si oui, pr√©cisez :</label>
                                    <input type="text" name="medication_details" class="form-control" placeholder="M√©dicaments, doses...">
                                </div>
                            </div>

                            <div class="d-flex justify-content-between">
                                <button type="button" class="btn btn-outline-secondary prev-section" data-prev="section-personal">
                                    <i class="fas fa-arrow-left me-2"></i>Pr√©c√©dent
                                </button>
                                <button type="button" class="btn btn-success next-section" data-next="section-profession">
                                    Suivant <i class="fas fa-arrow-right ms-2"></i>
                                </button>
                            </div>
                        </div>

                        <!-- √âtape 4: Profession et localisation -->
                        <div class="registration-section d-none" id="section-profession">
                            <h3 class="text-success mb-4">üìç Localisation et profession</h3>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Profession (optionnel)</label>
                                    <input type="text" name="profession" class="form-control" placeholder="Agriculteur, enseignant, commer√ßant...">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Statut vaccinal</label>
                                    <select name="vaccination_status" class="form-control">
                                        <option value="unknown">Inconnu</option>
                                        <option value="up_to_date">√Ä jour</option>
                                        <option value="partial">Partiel</option>
                                        <option value="none">Aucun vaccin</option>
                                    </select>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">R√©gion *</label>
                                    <select name="region" class="form-control" required>
                                        <option value="">S√©lectionnez votre r√©gion</option>
                                        <option value="Adamaoua">Adamaoua</option>
                                        <option value="Centre">Centre</option>
                                        <option value="Est">Est</option>
                                        <option value="Extr√™me-Nord">Extr√™me-Nord</option>
                                        <option value="Littoral">Littoral</option>
                                        <option value="Nord">Nord</option>
                                        <option value="Nord-Ouest">Nord-Ouest</option>
                                        <option value="Ouest">Ouest</option>
                                        <option value="Sud">Sud</option>
                                        <option value="Sud-Ouest">Sud-Ouest</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Village (optionnel)</label>
                                    <input type="text" name="village" class="form-control" placeholder="Nom de votre village">
                                </div>
                            </div>

                            <div class="d-flex justify-content-between">
                                <button type="button" class="btn btn-outline-secondary prev-section" data-prev="section-health">
                                    <i class="fas fa-arrow-left me-2"></i>Pr√©c√©dent
                                </button>
                                <button type="button" class="btn btn-success next-section" data-next="section-habits">
                                    Suivant <i class="fas fa-arrow-right ms-2"></i>
                                </button>
                            </div>
                        </div>

                        <!-- √âtape 5: Habitudes et environnement -->
                        <div class="registration-section d-none" id="section-habits">
                            <h3 class="text-success mb-4">üåø Environnement et habitudes</h3>
                            
                            <div class="mb-4">
                                <label class="form-label fw-bold">Facteurs environnementaux :</label>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" name="outdoor_work" value="true" id="outdoor_work">
                                    <label class="form-check-label" for="outdoor_work">
                                        Je travaille principalement en ext√©rieur
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" name="no_mosquito_net" value="true" id="no_mosquito_net">
                                    <label class="form-check-label" for="no_mosquito_net">
                                        Je n'utilise pas de moustiquaire
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" name="stagnant_water" value="true" id="stagnant_water">
                                    <label class="form-check-label" for="stagnant_water">
                                        Il y a de l'eau stagnante pr√®s de chez moi
                                    </label>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Acc√®s √† internet</label>
                                    <select name="internet_access" class="form-control">
                                        <option value="false">Non</option>
                                        <option value="true">Oui</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Acc√®s √† un t√©l√©phone</label>
                                    <select name="gsm_access" class="form-control">
                                        <option value="false">Non</option>
                                        <option value="true">Oui</option>
                                    </select>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Num√©ro de t√©l√©phone (optionnel)</label>
                                    <input type="tel" name="phone" class="form-control" placeholder="Pour les notifications">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Acc√®s aux soins de sant√©</label>
                                    <select name="health_access" class="form-control">
                                        <option value="unknown">Inconnu</option>
                                        <option value="good">Bon acc√®s</option>
                                        <option value="limited">Acc√®s limit√©</option>
                                        <option value="poor">Mauvais acc√®s</option>
                                    </select>
                                </div>
                            </div>

                            <div class="d-flex justify-content-between">
                                <button type="button" class="btn btn-outline-secondary prev-section" data-prev="section-profession">
                                    <i class="fas fa-arrow-left me-2"></i>Pr√©c√©dent
                                </button>
                                <button type="button" class="btn btn-success next-section" data-next="section-preferences">
                                    Suivant <i class="fas fa-arrow-right ms-2"></i>
                                </button>
                            </div>
                        </div>

                        <!-- √âtape 6: Pr√©f√©rences -->
                        <div class="registration-section d-none" id="section-preferences">
                            <h3 class="text-success mb-4">‚öôÔ∏è Pr√©f√©rences</h3>
                            
                            <div class="mb-4">
                                <label class="form-label fw-bold">Pr√©f√©rences de notification :</label>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" name="audio_preference" value="true" id="audio_preference">
                                    <label class="form-check-label" for="audio_preference">
                                        Je pr√©f√®re la lecture audio des messages
                                    </label>
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" name="allow_geolocation" value="true" id="allow_geolocation">
                                    <label class="form-check-label" for="allow_geolocation">
                                        Autoriser la g√©olocalisation pour des alertes pr√©cises
                                    </label>
                                </div>
                            </div>

                            <div class="d-flex justify-content-between">
                                <button type="button" class="btn btn-outline-secondary prev-section" data-prev="section-habits">
                                    <i class="fas fa-arrow-left me-2"></i>Pr√©c√©dent
                                </button>
                                <button type="button" class="btn btn-success next-section" data-next="section-final">
                                    Suivant <i class="fas fa-arrow-right ms-2"></i>
                                </button>
                            </div>
                        </div>

                        <!-- √âtape finale -->
                        <div class="registration-section d-none" id="section-final">
                            <h3 class="text-success mb-4">‚úÖ Finalisation</h3>
                            
                            <div class="mb-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="data_consent" id="data_consent" required>
                                    <label class="form-check-label fw-bold" for="data_consent">
                                        J'autorise l'usage de mes donn√©es (anonymis√©es) pour am√©liorer les recommandations
                                    </label>
                                </div>
                            </div>

                            <div class="alert alert-success">
                                <i class="fas fa-check-circle me-2"></i>
                                Votre profil nous aidera √† personnaliser vos conseils de sant√© et notifications.
                            </div>

                            <div class="d-flex justify-content-between">
                                <button type="button" class="btn btn-outline-secondary prev-section" data-prev="section-preferences">
                                    <i class="fas fa-arrow-left me-2"></i>Pr√©c√©dent
                                </button>
                                <button type="submit" class="btn btn-success btn-lg">
                                    <i class="fas fa-check me-2"></i>Cr√©er mon compte
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Navigation entre sections
    document.querySelectorAll('.next-section').forEach(button => {
        button.addEventListener('click', function() {
            const currentSection = this.closest('.registration-section');
            const nextSectionId = this.getAttribute('data-next');
            currentSection.classList.add('d-none');
            document.getElementById(nextSectionId).classList.remove('d-none');
        });
    });

    document.querySelectorAll('.prev-section').forEach(button => {
        button.addEventListener('click', function() {
            const currentSection = this.closest('.registration-section');
            const prevSectionId = this.getAttribute('data-prev');
            currentSection.classList.add('d-none');
            document.getElementById(prevSectionId).classList.remove('d-none');
        });
    });

    // Gestion dynamique des champs conditionnels
    const allergyToggle = document.querySelector('.allergy-toggle');
    const allergyDetails = document.querySelector('input[name="allergies_details"]');
    
    allergyToggle.addEventListener('change', function() {
        allergyDetails.disabled = this.value !== 'true';
    });

    const medicationToggle = document.querySelector('.medication-toggle');
    const medicationDetails = document.querySelector('input[name="medication_details"]');
    
    medicationToggle.addEventListener('change', function() {
        medicationDetails.disabled = this.value !== 'true';
    });

    // D√©sactiver les champs d√©taill√©s par d√©faut
    allergyDetails.disabled = true;
    medicationDetails.disabled = true;
});
</script>

<style>
.registration-section {
    animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.health-checkboxes {
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
    padding: 1rem;
}

.form-check {
    margin-bottom: 0.5rem;
}
</style>
{% endblock %}